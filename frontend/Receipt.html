<!DOCTYPE html>
<html lang="en">
<head>
  <title>Altius Academy | Payment Receipt</title>
  <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Icons -->
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

    <!-- Layout & Style -->
    <link rel="stylesheet" href="layout.css">
    <link rel="stylesheet" href="style.css">
</head>

<body>
<!-- ================= TOP BAR ================= -->
<header class="topbar">
    <div class="top-left">
        <button class="menu-btn" onclick="toggleSidebar()">☰</button>
        <a href="StaffHomepage.html" class="top-logo">
            <img src="images/logo1.png">
            <span>Altius Academy</span>
        </a>
    </div>

    <div class="top-right">
        <div class="user-btn" onclick="toggleUserMenu()">Staff ▾</div>
        <div class="user-dropdown" id="userDropdown">
            <a href="StaffHomepage.html">My Profile</a>
            <a href="#" onclick="logout()">Logout</a>
        </div>
    </div>
</header>

<div class="layout">

<!-- ================= SIDEBAR ================= -->
<aside class="sidebar" id="sidebar">
    <nav class="menu">
        <a href="TeacherList.html"><i class="fa-solid fa-chalkboard-user"></i><span>Teacher</span></a>
        <a href="StudentList.html" class="active"><i class="fa-solid fa-user-graduate"></i><span>Student</span></a>
        <a href="ClassList.html"><i class="fa-solid fa-school"></i><span>Class</span></a>
        <a href="EnrollmentList.html"><i class="fa-solid fa-file-signature"></i><span>Enrollment</span></a>
        <a href="PackageList.html"><i class="fa-solid fa-box"></i><span>Package</span></a>
        <a href="SubjectList.html"><i class="fa-solid fa-book"></i><span>Subject</span></a>
        <a href="AttendanceList.html"><i class="fa-solid fa-calendar-check"></i><span>Attendance</span></a>
        <a href="Report.html"><i class="fa-solid fa-chart-line"></i><span>Report</span></a>
    </nav>
</aside>

<main class="main">
  <h1>Payment Receipt</h1><br>

  <div class="receipt-card">
    <table class="receipt-table">
        <tr>
            <td><b>Receipt No:</b> </td>
            <td><span id="paymentId"></span></td>
        </tr>
        <tr>
            <td><b>Student Name:</b></td>
            <td><span id="studentName"></span></td>
        </tr>
        <tr>
            <td><b>IC:</b></td>
            <td><span id="studentIC"></span></td>
        </tr>
        <tr>
            <td><b>Enrollment ID:</b></td>
            <td><span id="enrollId"></span></td>
        </tr>
        <tr>
            <td><b>Package:</b></td>
            <td><span id="packageName"></span></td>
        </tr>
        <tr>
            <td><b>Amount Paid (RM):</b></td>
            <td><span id="amount"></span></td>
        </tr>
        <tr>
            <td><b>Payment Date:</b></td>
            <td><span id="paymentDate"></span></td>
        </tr>
    </table>
  </div>

  <button class="button" onclick="window.print()">Print Receipt</button>
</main>

<script>
/* ===== UI ===== */
function toggleSidebar(){ sidebar.classList.toggle("collapsed"); }
function toggleUserMenu(){
    userDropdown.style.display =
        userDropdown.style.display === "block" ? "none" : "block";
}
function logout(){
    localStorage.removeItem("staff");
    location.href = "login.html";
}

const enrollId = new URLSearchParams(window.location.search).get("enrollId");

if (!enrollId) {
  alert("Invalid receipt link");
  window.location.href = "EnrollmentList.html";
}

fetch(`http://localhost:3000/payment/receipt?enrollId=${enrollId}`)
  .then(res => {
    if (!res.ok) throw new Error("Receipt not found");
    return res.json();
  })
  .then(data => {
    document.getElementById("paymentId").textContent = data.PAYMENT_ID;
    document.getElementById("studentName").textContent = data.STUDENT_NAME;
    document.getElementById("studentIC").textContent = data.STUDENT_IC;
    document.getElementById("enrollId").textContent = data.ENROLL_ID;
    document.getElementById("packageName").textContent = data.PACKAGE_NAME;
    document.getElementById("amount").textContent =
      parseFloat(data.TOTAL_FEES).toFixed(2);
    document.getElementById("paymentDate").textContent =
      new Date(data.PAYMENT_DATE).toLocaleDateString();
  })
  .catch(err => {
    alert(err.message);
    window.location.href = "EnrollmentList.html";
  });
</script>
</body>
</html>
